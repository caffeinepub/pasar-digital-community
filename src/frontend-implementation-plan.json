{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Onboarding UI: hide raw authorization errors and show clear registration failure message",
  "requirements": [
    {
      "id": "REQ-2",
      "summary": "Normalize onboarding authorization-related failures into a clear English message and prevent raw backend error strings from being shown on the onboarding UI.",
      "acceptanceCriteria": [
        "On `/onboarding`, users do not see the raw error text `Unauthorized: Only admins can assign user roles` in the inline alert or toast.",
        "The user-facing error message is in English and is actionable (e.g., suggests trying again or contacting an admin), while preserving existing error mappings for invalid/used tokens and already-onboarded users."
      ],
      "file_operations": [
        {
          "path": "frontend/src/hooks/useOnboarding.ts",
          "operation": "modify",
          "description": "Extend error normalization for completeOnboarding so any authorization-related onboarding failure (including the `Unauthorized: Only admins can assign user roles` trap) is converted into a clear, actionable English registration message that does not mention admin role assignment; keep existing mappings for invalid/expired tokens, used tokens, and already-onboarded users; for unmapped errors, return a safe generic registration failure message instead of rethrowing the raw backend error."
        },
        {
          "path": "frontend/src/pages/OnboardingInvitePage.tsx",
          "operation": "modify",
          "description": "Ensure `/onboarding` only displays normalized, user-safe messages from the onboarding mutation (toast + inline Alert), avoiding fallback to raw error objects/strings; keep existing UX for token-required and first-admin claim flows."
        }
      ]
    }
  ]
}